<!DOCTYPE html>
<meta charset="utf-8">

{% extends "layout.html" %} {% block body %}

<script src="{{ url_for('static', filename='./bower_components/d3/d3.js') }}"></script>
<script src="{{ url_for('static', filename='./bower_components/d3-tip/index.js') }}"></script>
<script src="{{ url_for('static', filename='./bower_components/moment/moment.js') }}"></script>
<!-- <script src="{{ url_for('static', filename='./circle_packing.js') }}"></script> -->

<link href="{{ url_for('static', filename='./bower_components/keen-dashboards/dist/keen-dashboards.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='./circle_packing.css') }}" rel="stylesheet">

<button id="bugs-btn" type="button" class="btn btn-primary btn-sm">Bugs</button>
<button id="temp-coup-btn" type="button" class="btn btn-primary btn-sm">Temporal Coupling</button>
<button id="knowledge-map-btn" type="button" class="btn btn-primary btn-sm">Knowledge Map</button>
<button id="none-btn" type="button" class="btn btn-primary btn-sm">File Info</button>

<div id="circle-packing"></div>
<div id="legend"></div>

<span id="ruler"></span>

<script>

$.getScript("{{ url_for('static', filename='./circle_packing.js') }}", function(){
  var projectName = '{{ project_name }}';
  var intervals = {{ intervals | tojson }};
  if (projectName === null) {
    projectName = this.pathname.split('/').pop();
    console.log("project name was null. Setting it to " + projectName);
  }

  var intervalParams = "";
  if (intervals[0]) {
    intervalParams += "&start1=" + intervals[0][0] + "&end1=" + intervals[0][1];
  }
  if (intervals[1]) {
    intervalParams += "&start2=" + intervals[1][0] + "&end2=" + intervals[1][1];
  }
  var requestUrl = "/api/hotspots?project_name=" + projectName + intervalParams;

  console.log('Request url: ' + requestUrl);

  buildViz(requestUrl);
});

// Bind Buttons
$('#temp-coup-btn').on('click', function(e) {
  mode = PACKING_MODULES.TEMPORAL_COUPLING;
  colorCircles();
});
$('#bugs-btn').on('click', function(e) {
  mode = PACKING_MODULES.BUGS;
  colorCircles();
});
$('#none-btn').on('click', function(e) {
  mode = PACKING_MODULES.FILE_INFO;
  colorCircles();
});
$('#knowledge-map-btn').on('click', function(e) {
  mode = PACKING_MODULES.KNOWLEDGE_MAP;
  colorCircles();
});
</script>

{% endblock %}
